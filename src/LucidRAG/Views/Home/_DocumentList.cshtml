@model List<DocumentEntity>
@{
    string GetFileExtension(string filename) => System.IO.Path.GetExtension(filename ?? "").ToLowerInvariant();
}

@if (Model.Count == 0)
{
    <div class="text-center text-base-content/50 py-8">
        <p class="text-sm">No documents uploaded yet.</p>
        <p class="text-xs mt-1">Drag & drop files or click to upload.</p>
    </div>
}
else
{
    @foreach (var doc in Model)
    {
        var ext = GetFileExtension(doc.OriginalFilename);
        <label class="flex items-center gap-2 p-2 rounded hover:bg-base-200 cursor-pointer group"
               :class="selectedDocIds.has('@doc.Id') ? 'bg-primary/10' : ''">
            <input type="checkbox"
                   class="checkbox checkbox-sm checkbox-primary"
                   :checked="selectedDocIds.has('@doc.Id')"
                   :disabled="@(doc.Status != DocumentStatus.Completed ? "true" : "false")"
                   x-on:change="toggleDocument('@doc.Id', $event.target.checked)" />

            <!-- File type icon -->
            @switch (ext)
            {
                case ".pdf":
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 18H17V16H7V18ZM17 14H7V12H17V14ZM7 10H11V8H7V10ZM21 6V20C21 21.1 20.1 22 19 22H5C3.9 22 3 21.1 3 20V4C3 2.9 3.9 2 5 2H15L21 8V6ZM19 8L15 4H5V20H19V8Z"/>
                    </svg>
                    break;
                case ".docx":
                case ".doc":
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM16 18H8V16H16V18ZM16 14H8V12H16V14ZM13 9V3.5L18.5 9H13Z"/>
                    </svg>
                    break;
                case ".md":
                case ".markdown":
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.56 18H3.44C2.65 18 2 17.37 2 16.59V7.41C2 6.63 2.65 6 3.44 6H20.56C21.35 6 22 6.63 22 7.41V16.59C22 17.37 21.35 18 20.56 18ZM5 15V9H6.5L8 11L9.5 9H11V15H9.5V11.85L8 14L6.5 11.85V15H5ZM13.5 15V12H12L14.5 9L17 12H15.5V15H13.5Z"/>
                    </svg>
                    break;
                case ".txt":
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM16 18H8V16H16V18ZM16 14H8V12H16V14ZM13 9V3.5L18.5 9H13Z"/>
                    </svg>
                    break;
                case ".html":
                case ".htm":
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 17.56L16.07 16.43L16.62 10.33H9.38L9.2 8.3H16.8L17 6.31H7L7.56 12.32H14.45L14.22 14.9L12 15.5L9.78 14.9L9.64 13.24H7.64L7.93 16.43L12 17.56ZM4.07 3H19.93L18.5 19.2L12 21L5.5 19.2L4.07 3Z"/>
                    </svg>
                    break;
                default:
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2ZM13 9V3.5L18.5 9H13Z"/>
                    </svg>
                    break;
            }

            <span class="truncate flex-1 text-sm cursor-pointer hover:text-primary"
                  title="@doc.OriginalFilename - Click to view details"
                  @@click.stop="showDocumentDetails('@doc.Id')">
                @doc.Name
            </span>

            @await Html.PartialAsync("_DocumentStatusBadge", doc)

            <!-- Details button -->
            <button class="btn btn-ghost btn-xs opacity-0 group-hover:opacity-100"
                    @@click.stop="showDocumentDetails('@doc.Id')"
                    title="View document details">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>

            <button class="btn btn-ghost btn-xs opacity-0 group-hover:opacity-100"
                    hx-delete="/api/documents/@doc.Id"
                    hx-confirm="Delete '@doc.Name'?"
                    hx-swap="none"
                    hx-on::after-request="htmx.trigger(document.body, 'documentUploaded')">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </label>
    }
}
