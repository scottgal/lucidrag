<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:SignSummarizer.UI.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="SignSummarizer.UI.Controls.VideoPlayerControl">
    
    <Design.DataContext>
        <vm:VideoPlayerViewModel />
    </Design.DataContext>
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Video Display -->
        <Border Grid.Row="1" 
                Background="#1a1a1a"
                BorderBrush="#333"
                BorderThickness="1"
                CornerRadius="4"
                Margin="10">
            
            <Grid>
                <!-- Video/AvaloniaPlayer placeholder -->
                <Image Name="VideoImage" 
                       Stretch="Uniform"
                       StretchDirection="Both"
                       IsVisible="{Binding IsVideoLoaded}" />
                
                <!-- Animated GIF support -->
                <AnimatedImage Name="AnimatedGif"
                             Stretch="Uniform"
                             StretchDirection="Both"
                             IsVisible="{Binding IsGif}" />
                
                <!-- Placeholder when no media -->
                <TextBlock Text="No media loaded"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="#888"
                           FontSize="16"
                           IsVisible="{Binding !IsVideoLoaded}" />
                
                <!-- Loading indicator -->
                <StackPanel HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          IsVisible="{Binding IsLoading}">
                    <TextBlock Text="Loading..."
                               Foreground="#00aaff"
                               FontSize="18"
                               FontWeight="SemiBold" />
                    <ProgressBar IsIndeterminate="True"
                                 Width="200"
                                 Margin="0,10,0,0" />
                </StackPanel>
            </Grid>
            
            <!-- Subtitle Overlay -->
            <Panel IsVisible="{Binding AreSubtitlesVisible}">
                <StackPanel HorizontalAlignment="Center"
                          VerticalAlignment="Bottom"
                          Margin="20,40,20,20">
                    <Border Background="#80000000"
                            Padding="12,8"
                            CornerRadius="4">
                        <TextBlock Text="{Binding CurrentSubtitle}"
                                   Foreground="White"
                                   FontSize="18"
                                   FontWeight="Medium"
                                   TextWrapping="Wrap"
                                   TextAlignment="Center"
                                   MaxWidth="700" />
                    </Border>
                </StackPanel>
            </Panel>
        </Border>
        
        <!-- Controls -->
        <Grid Grid.Row="2" 
              Margin="10,0,10,10"
              ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto">
            
            <!-- Play/Pause -->
            <Button Grid.Column="0"
                    Command="{Binding PlayPauseCommand}"
                    Width="40"
                    Height="40"
                    CornerRadius="20"
                    Margin="0,0,10,0">
                <Panel>
                    <Path Data="{Binding IsPlaying, Converter={StaticResource PlayPauseIconConverter}}"
                          Fill="White"
                          Width="16"
                          Height="16"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center" />
                </Panel>
            </Button>
            
            <!-- Time Slider -->
            <Slider Grid.Column="1"
                    Value="{Binding CurrentTime}"
                    Maximum="{Binding Duration}"
                    TickFrequency="1"
                    IsSnapToTickEnabled="False"
                    HorizontalAlignment="Stretch"
                    VerticalAlignment="Center"
                    Margin="0,0,10,0" />
            
            <!-- Current Time -->
            <TextBlock Grid.Column="2"
                       Text="{Binding CurrentTimeString}"
                       VerticalAlignment="Center"
                       FontFamily="Consolas"
                       FontSize="12"
                       Margin="0,0,5,0" />
            
            <!-- Duration -->
            <TextBlock Grid.Column="3"
                       Text="{Binding DurationString}"
                       VerticalAlignment="Center"
                       FontFamily="Consolas"
                       FontSize="12"
                       Margin="0,0,15,0" />
            
            <!-- Volume -->
            <Button Grid.Column="4"
                    Command="{Binding ToggleMuteCommand}"
                    Width="40"
                    Height="40"
                    CornerRadius="20"
                    Margin="0,0,10,0">
                <TextBlock Text="{Binding IsMuted, Converter={StaticResource VolumeIconConverter}}"
                           Foreground="White"
                           FontSize="18"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
            </Button>
            
            <!-- Subtitles Toggle -->
            <Button Grid.Column="5"
                    Command="{Binding ToggleSubtitlesCommand}"
                    Width="40"
                    Height="40"
                    CornerRadius="20"
                    Background="{Binding AreSubtitlesVisible, Converter={StaticResource BoolToActiveConverter}}">
                <TextBlock Text="CC"
                           Foreground="White"
                           FontSize="12"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
            </Button>
        </Grid>
    </Grid>
</UserControl>
